{"version":3,"sources":["../../../app/v1/controllers/tripController.js"],"names":["COSTOKM","TripController","req","res","driver","Trip","create","body","trip","Driver","updateDriver","rows","id","status","json","message","getAllActive","length","params","estatus","updateTrip","conductor_id","punto_inicio","lon1","lon","lat1","lat","punto_destino","lon2","lat2","distance","Invoice","tripId","riderId","pasajero_id","driverId","cost","impuesto","invoice"],"mappings":";;;;;;;;;;;;;;;;;AAAA;;AACA;;AACA;;AACA;;AAEA,IAAMA,OAAO,GAAG,GAAhB;;IAEqBC,c;;;;;;;;uHACKC,G,EAAKC,G;;;;;;AACnBC,gBAAAA,M,GAAWF,G,CAAXE,M;;uBACWC,iBAAKC,MAAL,CAAYJ,GAAG,CAACK,IAAhB,C;;;AAAbC,gBAAAA,I;;uBACAC,mBAAOC,YAAP,CAAoB,KAApB,EAA2BN,MAAM,CAACO,IAAP,CAAY,CAAZ,EAAeC,EAA1C,C;;;iDACCT,GAAG,CACPU,MADI,CACG,GADH,EAEJC,IAFI,CAEC;AAAEC,kBAAAA,OAAO,EAAE,6BAAX;AAA0CP,kBAAAA,IAAI,EAAEA,IAAI,CAACG,IAAL,CAAU,CAAV;AAAhD,iBAFD,C;;;;;;;;;;;;;;;;;;;4HAKmBT,G,EAAKC,G;;;;;;;;uBACRE,iBAAKW,YAAL,E;;;;AAAfL,gBAAAA,I,yBAAAA,I;kDACDA,IAAI,CAACM,MAAL,GAAc,CAAd,GACHd,GAAG,CAACU,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AACnBC,kBAAAA,OAAO,EAAE;AADU,iBAArB,CADG,GAIHZ,GAAG,CAACU,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBH,IAArB,C;;;;;;;;;;;;;;;;;;;0HAEoBT,G,EAAKC,G;;;;;;;AACrBS,gBAAAA,E,GAAOV,GAAG,CAACgB,M,CAAXN,E;AACAJ,gBAAAA,I,GAASN,G,CAATM,I;;qBACJA,IAAI,CAACG,IAAL,CAAU,CAAV,EAAaQ,O;;;;;kDACRhB,GAAG,CAACU,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAAEC,kBAAAA,OAAO,EAAE;AAAX,iBAArB,C;;;;uBAEcV,iBAAKe,UAAL,CAAgBR,EAAhB,C;;;;AAAfD,gBAAAA,I,yBAAAA,I;;uBACFF,mBAAOC,YAAP,CAAoB,IAApB,EAA0BC,IAAI,CAAC,CAAD,CAAJ,CAAQU,YAAlC,C;;;kCAE2B,6BAAeV,IAAI,CAAC,CAAD,CAAJ,CAAQW,YAAvB,C,EAApBC,I,mBAALC,G,EAAgBC,I,mBAALC,G;mCACc,6BAAef,IAAI,CAAC,CAAD,CAAJ,CAAQgB,aAAvB,C,EAApBC,I,oBAALJ,G,EAAgBK,I,oBAALH,G;AACbI,gBAAAA,Q,GAAW,gCAAkBL,IAAlB,EAAwBF,IAAxB,EAA8BM,IAA9B,EAAoCD,IAApC,C;;uBACKG,oBAAQzB,MAAR,CAAe;AACnC0B,kBAAAA,MAAM,EAAEpB,EAD2B;AAEnCqB,kBAAAA,OAAO,EAAEtB,IAAI,CAAC,CAAD,CAAJ,CAAQuB,WAFkB;AAGnCC,kBAAAA,QAAQ,EAAExB,IAAI,CAAC,CAAD,CAAJ,CAAQU,YAHiB;AAInCe,kBAAAA,IAAI,EAAEN,QAAQ,GAAG9B,OAAX,GAAsB8B,QAAQ,GAAG9B,OAAX,GAAqB,GAJd;AAKnCqC,kBAAAA,QAAQ,EAAED,IAAI,GAAG;AALkB,iBAAf,C;;;AAAhBE,gBAAAA,O;kDAOCnC,GAAG,CAACU,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAC1BC,kBAAAA,OAAO,EAAE,+BADiB;AAE1BP,kBAAAA,IAAI,EAAEG,IAAI,CAAC,CAAD,CAFgB;AAG1B2B,kBAAAA,OAAO,EAAEA,OAAO,CAAC3B,IAAR,CAAa,CAAb;AAHiB,iBAArB,C","sourcesContent":["import Driver from \"../database/Driver\";\nimport Trip from \"../database/Trip\";\nimport { calculateDistance, getCoordinates } from \"../helpers/helpers\";\nimport Invoice from \"../database/Invoice\";\n\nconst COSTOKM = 700;\n\nexport default class TripController {\n  static async createTrip(req, res) {\n    const { driver } = req;\n    const trip = await Trip.create(req.body);\n    await Driver.updateDriver(false, driver.rows[0].id);\n    return res\n      .status(201)\n      .json({ message: \"Viaje creado con exito !!! \", trip: trip.rows[0] });\n  }\n\n  static async getActiveTrips(req, res) {\n    const { rows } = await Trip.getAllActive();\n    return rows.length < 1\n      ? res.status(404).json({\n          message: \"No se encontraon viajes en la base de datos !!!\",\n        })\n      : res.status(200).json(rows);\n  }\n  static async completeTrip(req, res) {\n    const { id } = req.params;\n    const { trip } = req;\n    if (trip.rows[0].estatus) {\n      return res.status(409).json({ message: \"Viaje ya estÃ¡ finalizado !!!\" });\n    }\n    const { rows } = await Trip.updateTrip(id);\n    await Driver.updateDriver(true, rows[0].conductor_id);\n\n    const { lon: lon1, lat: lat1 } = getCoordinates(rows[0].punto_inicio);\n    const { lon: lon2, lat: lat2 } = getCoordinates(rows[0].punto_destino);\n    const distance = calculateDistance(lat1, lon1, lat2, lon2);\n    const invoice = await Invoice.create({\n      tripId: id,\n      riderId: rows[0].pasajero_id,\n      driverId: rows[0].conductor_id,\n      cost: distance * COSTOKM + (distance * COSTOKM * 0.1),\n      impuesto: cost * 0.1 \n    });\n    return res.status(200).json({\n      message: \"Viaje culminado con exito !!!\",\n      trip: rows[0],\n      invoice: invoice.rows[0],\n    });\n  }\n}\n"],"file":"tripController.js"}