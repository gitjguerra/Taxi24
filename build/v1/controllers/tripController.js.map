{"version":3,"sources":["../../../app/v1/controllers/tripController.js"],"names":["COSTOKM","TripController","req","res","driver","Trip","create","body","trip","Driver","updateDriver","rows","id","status","json","message","getAllActive","length","params","console","log","estatus","updateTrip","conductor_id","punto_inicio","lon1","lon","lat1","lat","punto_destino","lon2","lat2","distance","pasajero_id","Invoice","tripId","riderId","driverId","cost","impuesto","invoice"],"mappings":"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","sourcesContent":["import Driver from \"../database/Driver\";\nimport Trip from \"../database/Trip\";\nimport { calculateDistance, getCoordinates } from \"../helpers/helpers\";\nimport Invoice from \"../database/Invoice\";\n\nconst COSTOKM = 700;\n\nexport default class TripController {\n  static async createTrip(req, res) {\n    const { driver } = req;\n    const trip = await Trip.create(req.body);\n    await Driver.updateDriver(false, driver.rows[0].id);\n    return res\n      .status(201)\n      .json({ message: \"Viaje creado con exito !!! \", trip: trip.rows[0] });\n  }\n\n  static async getActiveTrips(req, res) {\n    const { rows } = await Trip.getAllActive();\n    return rows.length < 1\n      ? res.status(404).json({\n          message: \"No se encontraon viajes en la base de datos !!!\",\n        })\n      : res.status(200).json(rows);\n  }\n  static async completeTrip(req, res) {\n    const { id } = req.params;\n    const { trip } = req;\n    console.log(\"id1 \" + id);\n    if (trip.rows[0].estatus) {\n      return res.status(409).json({ message: \"Viaje ya estÃ¡ finalizado !!!\" });\n    }\n    console.log(\"id2 \" + id);\n    const { rows } = await Trip.updateTrip(id);\n    await Driver.updateDriver(true, rows[0].conductor_id);\n    console.log(\"conductor_id \" + rows[0].conductor_id);\n\n    const { lon: lon1, lat: lat1 } = getCoordinates(rows[0].punto_inicio);\n    const { lon: lon2, lat: lat2 } = getCoordinates(rows[0].punto_destino);\n    const distance = calculateDistance(lat1, lon1, lat2, lon2);\n    console.log(\"distance \" + distance);\n    console.log(\"rows[0].pasajero_id \" + rows[0].pasajero_id);\n    console.log(\"rows[0].conductor_id \" + rows[0].conductor_id);\n    console.log(\"cost \" + distance * COSTOKM + (distance * COSTOKM * 0.1));\n    console.log(\"cost \" + distance * COSTOKM * 0.1);\n    const invoice = await Invoice.create({\n      tripId: id,\n      riderId: rows[0].pasajero_id,\n      driverId: rows[0].conductor_id,\n      cost: distance * COSTOKM + (distance * COSTOKM * 0.1),\n      impuesto: distance * COSTOKM * 0.1 \n    });\n    return res.status(200).json({\n      message: \"Viaje culminado con exito !!!\",\n      trip: rows[0],\n      invoice: invoice.rows[0],\n    });\n  }\n}\n"],"file":"tripController.js"}